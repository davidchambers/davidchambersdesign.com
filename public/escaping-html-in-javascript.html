<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Escaping HTML in JavaScript</title>
    <link rel="alternate" type="application/atom+xml" href="/feed/" />
    <link rel="stylesheet" href="/css/reset.css" media="all" />
    <link rel="stylesheet" href="/css/print.css" media="print" />
    <link rel="stylesheet" href="/css/screen.css" media="screen" />
    <link rel="shortcut icon" type="image/x-icon" href="http://static.davidchambersdesign.com/favicon.ico" />
    <script src="http://use.typekit.com/jhk0ogh.js"></script>
    <script>try{Typekit.load();}catch(e){}</script>
  </head>
  <body>
    <div id="skip">
      <a href="#main">Skip to main content</a>
    </div>
    <div id="wrap">
      <div id="header">
        <header>
          <a id="title" href="/">David Chambers Design</a>
          <hr />
          <p>It's where I share interesting info with other web geeks</p>
          <nav id="nav">
            <ul>
              <li><a href="/about/"><span><strong>About.</strong> Who I am and what I do.</span></a></li>
              <li><a href="/contact/"><span><strong>Contact.</strong> Just in case you want to get in touch.</span></a></li>
              <li><a href="/archives/"><span><strong>Archives.</strong> Old posts, recent posts, they're all here.</span></a></li>
              <li><a href="/tags/"><span><strong>Tags.</strong> Helpful if you're after posts on a particular topic.</span></a></li>
              <li><a href="https://bitbucket.org/davidchambers"><span><strong>Bitbucket.</strong> Home to most of my open-source projects.</span></a></li>
              <li><a href="/twitter/"><span><strong>Twitter.</strong> It's where I chirrup… or chirp… or something.</span></a></li>
            </ul>
          </nav>
        </header>
      </div>
      <div id="main">
        <article>
          <header>
            <h1>Escaping HTML in JavaScript</h1>
            <time datetime="2011-05-30T15:00:00-07:00" pubdate="pubdate">30 May 2011</time>
          </header>
          <p>I recently came across an interesting article at <a href="http://wonko.com/">wonko.com</a> on <a href="http://wonko.com/post/html-escaping">HTML escaping</a>, which provoked me to rewrite Bitbucket's escape function (invoked from within Underscore templates):</p>
          <pre><code>function makeSafe(text) {
  return text.replace(/[&amp;&lt;&gt;"'`]/g, function (chr) {
    return '&amp;#' + chr.charCodeAt(0) + ';';
  });
};</code></pre>
          <p>This ensures that inserted content cannot escape the confines of a quoted attribute value. Unquoted attributes are more problematic:</p>
          <blockquote>
            <p>Unquoted attribute values are one of the single biggest XSS vectors there is. If you don’t quote your attribute values, you’re essentially leaving the door wide open for naughty people to inject naughty things into your HTML. Very few escaper implementations cover all the edge cases necessary to prevent unquoted attribute values from becoming XSS vectors.</p>
          </blockquote>
          <p>To accommodate unquoted attribute values, the following function could be used instead:</p>
          <pre><code>function makeSafe(text) {
  return text.replace(/\W/g, function (chr) {
    return '&amp;#' + chr.charCodeAt(0) + ';';
  });
};</code></pre>
          <p>I created a <a href="http://jsperf.com/html-escaping-perf">jsPerf test case</a> which confirms that there's a performance hit associated with using this more liberal regular expression. Keep in mind, though, that if “A” takes 1ms to execute and “B” takes ten times as long, “B” still only takes 10ms. Quite often a significant <em>comparative</em> speed difference is insignificant in absolute terms; I'd argue that this is the case here.</p>
          <footer class="metadata">
            <ul>
              <li class="shorturl"><a href="http://dċd.ws/14/">Short URL</a></li>
            </ul>
            <h4>This post has the following tags:</h4>
            <ol>
              <li><a href="/tag/best-practice/">best practice</a></li>
              <li><a href="/tag/javascript/">JavaScript</a></li>
              <li><a href="/tag/security/">security</a></li>
            </ol>
          </footer>
          <h3 id="related">Possibly related posts</h3>
          <ul>
            <li><a href="/extra-comma-considered-harmful/">Extra comma considered harmful</a></li>
            <li><a href="/associative-arrays-in-javascript/">Associative arrays in JavaScript</a></li>
            <li><a href="/getting-truth-out-of-the-dom/">Getting truth out of the DOM – Yehuda Katz</a></li>
            <li><a href="/the-perils-of-using-javascript-objects-as-sets/">The perils of using JavaScript objects as sets</a></li>
            <li><a href="/captions-over-images/">Captions over images</a></li>
          </ul>
        </article>
      </div>
    </div>
    <footer>
      <p>Powered by <a href="http://mango.io/wtf?" data-version="0.9dev">Mango</a>. Hosted on <a href="http://www.linode.com/?r=ce523c9eeda64e4bceaf7011dc9e8558b909711d">Linode</a>. Original content <a href="/copying/">WTFPL-licensed</a>.</p>
    </footer>
  </body>
</html>
