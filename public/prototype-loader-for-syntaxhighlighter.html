<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Prototype loader for SyntaxHighlighter</title>
    <link rel="alternate" type="application/atom+xml" href="/feed/" />
    <link rel="stylesheet" href="/public/css/reset.css" media="all" />
    <link rel="stylesheet" href="/public/css/print.css" media="print" />
    <link rel="stylesheet" href="/public/css/screen.css" media="screen" />
    <link rel="shortcut icon" type="image/x-icon" href="http://static.davidchambersdesign.com/favicon.ico" />
    <script src="http://use.typekit.com/jhk0ogh.js"></script>
    <script>try{Typekit.load();}catch(e){}</script>
  </head>
  <body>
    <div id="skip">
      <a href="#main">Skip to main content</a>
    </div>
    <div id="wrap">
      <div id="header">
        <header>
          <a id="title" href="/">David Chambers Design</a>
          <hr />
          <p>It's where I share interesting info with other web geeks</p>
          <nav id="nav">
            <ul>
              <li><a href="/about/"><span><strong>About.</strong> Who I am and what I do.</span></a></li>
              <li><a href="/contact/"><span><strong>Contact.</strong> Just in case you want to get in touch.</span></a></li>
              <li><a href="/archives/"><span><strong>Archives.</strong> Old posts, recent posts, they're all here.</span></a></li>
              <li><a href="/tags/"><span><strong>Tags.</strong> Helpful if you're after posts on a particular topic.</span></a></li>
              <li><a href="https://bitbucket.org/davidchambers"><span><strong>Bitbucket.</strong> Home to most of my open-source projects.</span></a></li>
              <li><a href="/twitter/"><span><strong>Twitter.</strong> It's where I chirrup… or chirp… or something.</span></a></li>
            </ul>
          </nav>
        </header>
      </div>
      <div id="main">
        <article>
          <header>
            <h1>Prototype loader for SyntaxHighlighter</h1>
            <time datetime="2009-06-22T01:04:00+12:00" pubdate="pubdate">22 June 2009</time>
          </header>
<p>Skip to <a href="#setup">setup</a> or <a href="#usage">usage</a></p>
<hr />
<p><a href="http://alexgorbatchev.com/wiki/SyntaxHighlighter">SyntaxHighlighter</a> is a fully functional self-contained code syntax
highlighter developed in JavaScript (as stated on its wiki). One of its
deficiencies is that it retrieves all its brushes each time a page is
loaded, despite the fact that in many cases only one or two (or none)
are required.</p>
<p>Currently, <a href="http://prototypejs.org/">Prototype</a> is my JavaScript framework of choice (although
I'm really looking forward to trying <a href="http://jquery.com/">jQuery</a>). I have used Prototype to
create a <strong>brush loader for SyntaxHighlighter</strong>, which retrieves brushes on
demand to reduce page loading times (in certain circumstances).</p>
<hr />
<hr />
<h4>Update: 27 June 2009, 6:21am (Pacific/Auckland)</h4>
<p>I have completely rewritten the code so that it no longer requires empty
functions inside the brush files to act as indicators of readiness. Instead,
the required brushes are retrieved in a daisy chain. This is both more elegant
and more reliable. Additionally, style sheets are now also retrieved on
demand.</p>
<hr />
<h3>Setup {@id=setup}</h3>
<p><strong>Requires Prototype!</strong></p>
<p>If you are not already using Prototype on your site, I recommend using
SyntaxHighlighter in the conventional manner, since there is significant
overhead associated with loading <code>prototype.js</code>.</p>
<p>If you <em>are</em> using Prototype, follow these steps to have brushes retrieved
dynamically:</p>
<ol>
<li>
<p>Download <a href="/downloads/loader.js">loader.js</a> or the
    <a href="/downloads/loader.min.js.gz">minified and gzipped version</a> and
    upload it to your SyntaxHighlighter <strong>scripts</strong> directory.</p>
</li>
<li>
<p>Replace:</p>
<pre><code>:::html
&lt;script src="/path/to/scripts/shCore.js"&gt;&lt;/script&gt;
&lt;script src="/path/to/scripts/shBrushAS3.js"&gt;&lt;/script&gt;
&lt;script src="/path/to/scripts/shBrushBash.js"&gt;&lt;/script&gt;
.
.
.
&lt;script src="/path/to/scripts/shBrushVb.js"&gt;&lt;/script&gt;
&lt;script src="/path/to/scripts/shBrushXml.js"&gt;&lt;/script&gt;

&lt;script&gt;SyntaxHighlighter.all()&lt;/script&gt;
</code></pre>
<p>with:</p>
<pre><code>:::html
&lt;script&gt;
    function Brush(name, filename, aliases)
    {
        this.name = name;
        this.filename = filename;
        this.aliases = aliases;
    }
    var settings = {
        selector: 'head',
        path: 'http://example.com/sh/',
        stylesheets: ['shThemeDefault'],
        brushes: [],
        extensions: { stylesheet: 'css', brush: 'js' },
        defaults: {}
    };
&lt;/script&gt;
&lt;script src="/path/to/scripts/loader.js"&gt;&lt;/script&gt;
</code></pre>
</li>
<li>
<p>Replace both instances of <code>http://example.com/sh/</code> in the above snippet
    with the path to your <strong>SyntaxHighlighter</strong> directory.</p>
</li>
</ol>
<h3>Usage {@id=usage}</h3>
<p>The <code>settings</code> object provides flexibility by allowing various things to be
modified or included.</p>
<p><strong>Selector.</strong> By default, <code>settings.selector</code> is set to 'head', which means
that script elements will be inserted into the head element. This can be
replaced with any CSS selector to have script elements inserted into a
different element.</p>
<p><strong>Style sheets.</strong> By default, <code>settings.stylesheets</code> is an array containing
just the default style sheet. This can easily be modified:</p>
<pre><code>:::javascript
stylesheets: ['shThemeCoda', 'shThemeAppleScript'],
</code></pre>
<p><strong>Brushes.</strong> By default, <code>settings.brushes</code> is an empty array. All the bundled
brushes are handled automatically, but additional brushes can be included by
adding them to this array:</p>
<pre><code>:::javascript
brushes: [
    new Brush('AppleScript', 'shBrushAppleScript', ['applescript'])
],
</code></pre>
<p>When creating a <code>Brush</code> object, provide the constructor with the brush's name,
its file name (sans extension), and an array of aliases.</p>
<p><strong>Extensions.</strong> By default, <code>settings.extensions</code> has 'css' set against
<code>stylesheet</code> and 'js' set against <code>brush</code>. It is useful to be able to change
these values if, for example, gzipped versions of the brushes are to be used.</p>
<p><strong>Defaults.</strong> SyntaxHighlighter defaults can be set by modifying
<code>settings.defaults</code>:</p>
<pre><code>:::javascript
defaults: {
    'auto-links': false,
    'html-script': true
}
</code></pre>
<p>Many thanks to Dan Breslau for letting me know about
<code>SyntaxHighlighter.highlight()</code> and for his thorough testing of each of the
early iterations of this code. Dan's <a href="http://www.outofwhatbox.com/blog/2009/06/syntaxhighlighter-revised-again-works-on-its-own-once-again/">SyntaxHighlighter improvements</a> are
well worth a look!</p>
<hr />
<h4>Update: 27 June 2009, 6:21am (Pacific/Auckland)</h4>
<p>Thanks also to Bob Matsuoka for sharing his <a href="http://ajaxian.com/archives/a-technique-for-lazy-script-loading">technique for lazy script
loading</a> which provides workarounds for browsers that do not support the
onload event when applied to script elements.</p>
<hr />
<hr />
<h4>Update: 16 August 2009, 1:24am (Pacific/Auckland)</h4>
<p>I've updated the script to ensure that the XML brush is always loaded when
at least one of the following conditions is true:</p>
<ol>
<li><code>settings.defaults['html-script']</code> is set to <code>true</code></li>
<li>a pre element to be highlighted has <code>html-script: true</code> in its class name</li>
</ol>
<hr />
          <footer class="metadata">
            <ul>
              <li class="shorturl"><a href="http://dċd.ws/14/">Short URL</a></li>
            </ul>
            <h4>This post has the following tags:</h4>
            <ol>
              <li><a href="/tag/JavaScript/">JavaScript</a></li>
              <li><a href="/tag/optimization/">optimization</a></li>
              <li><a href="/tag/Prototype/">Prototype</a></li>
              <li><a href="/tag/SyntaxHighlighter/">SyntaxHighlighter</a></li>
            </ol>
          </footer>
          <h3 id="related">Possibly related posts</h3>
          <ul>
            <li><a href="http://davidchambersdesign.com/cricket-field-diagrams/">Cricket field diagrams</a></li>
            <li><a href="http://davidchambersdesign.com/tiny-calendar-icons-sprite/">Tiny calendar icons sprite</a></li>
            <li><a href="http://davidchambersdesign.com/bike-shelf/">Bike shelf</a></li>
            <li><a href="http://davidchambersdesign.com/man-after-my-own-heart/">Man after my own heart</a></li>
            <li><a href="http://davidchambersdesign.com/dieter-rams-video-interview/">Dieter Rams video interview</a></li>
          </ul>
        </article>
      </div>
    </div>
    <footer>
      <p>Powered by <a href="http://mango.io/wtf?" data-version="0.9dev">Mango</a>. Hosted on <a href="http://www.linode.com/?r=ce523c9eeda64e4bceaf7011dc9e8558b909711d">Linode</a>. Original content <a href="/copying/">WTFPL-licensed</a>.</p>
    </footer>
  </body>
</html>
