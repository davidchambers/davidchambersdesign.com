<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Intelligent CSS caching</title>
    <link rel="alternate" type="application/atom+xml" href="/feed/" />
    <link rel="stylesheet" href="/css/reset.css" media="all" />
    <link rel="stylesheet" href="/css/print.css" media="print" />
    <link rel="stylesheet" href="/css/screen.css" media="screen" />
    <link rel="shortcut icon" type="image/x-icon" href="http://static.davidchambersdesign.com/favicon.ico" />
    <script src="http://use.typekit.com/jhk0ogh.js"></script>
    <script>try{Typekit.load();}catch(e){}</script>
  </head>
  <body>
    <div id="skip">
      <a href="#main">Skip to main content</a>
    </div>
    <div id="wrap">
      <div id="header">
        <header>
          <a id="title" href="/">David Chambers Design</a>
          <hr />
          <p>It's where I share interesting info with other web geeks</p>
          <nav id="nav">
            <ul>
              <li><a href="/about/"><span><strong>About.</strong> Who I am and what I do.</span></a></li>
              <li><a href="/contact/"><span><strong>Contact.</strong> Just in case you want to get in touch.</span></a></li>
              <li><a href="/archives/"><span><strong>Archives.</strong> Old posts, recent posts, they're all here.</span></a></li>
              <li><a href="/tags/"><span><strong>Tags.</strong> Helpful if you're after posts on a particular topic.</span></a></li>
              <li><a href="https://bitbucket.org/davidchambers"><span><strong>Bitbucket.</strong> Home to most of my open-source projects.</span></a></li>
              <li><a href="/twitter/"><span><strong>Twitter.</strong> It's where I chirrup… or chirp… or something.</span></a></li>
            </ul>
          </nav>
        </header>
      </div>
      <div id="main">
        <article>
          <header>
            <h1>Intelligent CSS caching</h1>
            <time datetime="2008-12-18T14:50:00+13:00" pubdate="pubdate">18 December 2008</time>
          </header>
          <p>If you've ever worked with CSS, you'll understand how frustrating it is to edit a style sheet and be unable to view the change because a cached version of the file is being used. One line of PHP will fix this problem, and will also ensure that visitors never view your site through the lens of an outdated style sheet.</p>
          <p>If you've ever worked with CSS, you'll understand how frustrating it is to edit a style sheet and be unable to view the change because a cached version of the file is being used.</p>
          <p>In the past, I've adopted an unscientific approach to working around this problem: I've done forced refreshes, relaunched browsers, emptied caches, and even disabled caching entirely using Firefox's Web Developer extension.</p>
          <p>Each of these workarounds is problematic in some way: browsers do not agree on exactly what a page refresh should do; quitting and relaunching a browser is time-consuming (particularly with Firefox on OS X); emptying the cache gobbles up bandwidth; and disabling caching slows down the testing process by forcing a bunch of static files to be retrieved from the server every time the page is loaded.</p>
          <p>While the problem of cached style sheets is largely an annoyance confined to the development environment, it occasionally causes problems at other times. For example, let's say that you've made a minor change to a site's source code – you've changed <code>&lt;div id="wrapper"&gt;</code> to <code>&lt;div id="wrap"&gt;</code>. You've also done a find and replace on the style sheet, and rolled both changes live. A new visitor to the site will have no problems, but a returning visitor may see the site through the lens of an out-of-date style sheet. Yikes!</p>
          <p>I decided that it was time to find a reliable solution to the above problems. I came across an article on <a href="http://css-tricks.com/can-we-prevent-css-caching/">timestamping CSS</a> which suggests appending a unique string to a style sheet's href when linking to it in a page's <code>&lt;head&gt;</code>.</p>
          <p>After reading the replies to the above post, and taking on board several good suggestions, here is the PHP code I have decided upon:</p>
          <pre><code>href="path/to/style.css?&lt;?php echo date('Y-m-d-H-i-s', filectime('path/to/style.css')); ?&gt;"</code></pre>
          <p>The above generates something like this:</p>
          <pre><code>href="path/to/style.css?2008-12-16-20-02-53"</code></pre>
          <p>The nice thing about using <a href="http://php.net/manual/en/function.filectime.php">PHP's filectime function</a> is that the timestamp is dependent on the time at which the CSS file was last modified. This means that the cached style sheet is used when it is <strong>up to date</strong>, but the file is retrieved from the server when it has been <strong>changed in any way</strong>.</p>
          <footer class="metadata">
            <ul>
              <li class="shorturl"><a href="http://dċd.ws/14/">Short URL</a></li>
            </ul>
            <h4>This post has the following tags:</h4>
            <ol>
              <li><a href="/tag/CSS/">CSS</a></li>
              <li><a href="/tag/PHP/">PHP</a></li>
            </ol>
          </footer>
          <h3 id="related">Possibly related posts</h3>
          <ul>
            <li><a href="/valid-xhtml-alternative-to-strike/">Valid XHTML alternative to <code>&lt;strike&gt;</code></a></li>
            <li><a href="/wordpress-login-redirect/">WordPress login redirect</a></li>
            <li><a href="/escape-special-characters-for-sql-regexp/">Escape special characters for SQL REGEXP</a></li>
            <li><a href="/sticky-footers/">Sticky footers</a></li>
            <li><a href="/php-print_filesize-function/">PHP print_filesize function</a></li>
          </ul>
        </article>
      </div>
    </div>
    <footer>
      <p>Powered by <a href="http://mango.io/wtf?" data-version="0.9dev">Mango</a>. Hosted on <a href="http://www.linode.com/?r=ce523c9eeda64e4bceaf7011dc9e8558b909711d">Linode</a>. Original content <a href="/copying/">WTFPL-licensed</a>.</p>
    </footer>
  </body>
</html>
